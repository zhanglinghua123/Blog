name: learn-github-actions
on:
  push:
    branches:
      - release

env:
  MY_SERVER_PRIVATE_KEY:  ${{secrets.MY_SERVER_PRIVATE_KEY}}
  MY_SERVER_USER: root
  MY_SERVER_IP: 101.35.35.56
  My_SERVER_PRIVATE_KEY_PLUS : ${{secrets.MY_SERVER_PRIVATE_KEY}}
  cache-name: 2020
jobs:
  build-production:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: 14
      - name : Install Dependency
        run: npm install
      - name : Build the Blog
        run: npm run build
      - name : Printf the ENV
        run  : echo "The IP is ${{ env.MY_SERVER_IP }} , The User is ${{ env.MY_SERVER_USER }} , The Private_Key is ${{env.MY_SERVER_PRIVATE_KEY}} "
      - name : Print
        run  : echo "ğŸ‰ The job was automatically triggered by a ${{ github.event_name }} event."
      - name: Deploy to Server # ç¬¬äºŒæ­¥ï¼Œrsyncæ¨æ–‡ä»¶
        uses: AEnterprise/rsync-deploy@v1.0 # ä½¿ç”¨åˆ«äººåŒ…è£…å¥½çš„æ­¥éª¤é•œåƒ
        env:
          DEPLOY_KEY: ${{ env.MY_SERVER_PRIVATE_KEY }} # å¼•ç”¨é…ç½®ï¼ŒSSHç§é’¥
          ARGS: -avz --delete --exclude='' # rsyncå‚æ•°ï¼Œæ’é™¤.pycæ–‡ä»¶
          SERVER_PORT: '22' # SSHç«¯å£
          FOLDER: build # è¦æ¨é€çš„æ–‡ä»¶å¤¹ï¼Œè·¯å¾„ç›¸å¯¹äºä»£ç ä»“åº“çš„æ ¹ç›®å½•
          SERVER_IP: ${{ env.MY_SERVER_IP }} # å¼•ç”¨é…ç½®ï¼ŒæœåŠ¡å™¨çš„hoståï¼ˆIPæˆ–è€…åŸŸådomain.comï¼‰
          USERNAME: ${{ env.MY_SERVER_USER }} # å¼•ç”¨é…ç½®ï¼ŒæœåŠ¡å™¨ç™»å½•å
          SERVER_DESTINATION: ./home/ubuntu/Blog/Deploy # éƒ¨ç½²åˆ°ç›®æ ‡æ–‡ä»¶å¤¹
      - name: Restart server # ç¬¬ä¸‰æ­¥ï¼Œé‡å¯æœåŠ¡
        uses: appleboy/ssh-action@master
        with:
          host: ${{ env.MY_SERVER_IP }} # ä¸‹é¢ä¸‰ä¸ªé…ç½®ä¸ä¸Šä¸€æ­¥ç±»ä¼¼
          username: ${{ env.MY_SERVER_USER }}
          key: ${{ env.MY_SERVER_PRIVATE_KEY }}
          # é‡å¯çš„è„šæœ¬ï¼Œæ ¹æ®è‡ªèº«æƒ…å†µåšç›¸åº”æ”¹åŠ¨ï¼Œä¸€èˆ¬è¦åšçš„æ˜¯migrateæ•°æ®åº“ä»¥åŠé‡å¯æœåŠ¡å™¨
          script: |
            ls

